# README.md
1: Заголовок проекта, подчёркивающий схему-ориентированный сбор показаний.
2: Пустая строка для отделения заголовка.
3: Короткое описание: веб-приложение строит интерфейс по JSON-схеме, сохраняет данные, показывает только свои записи.
4: Пустая строка для разделения блоков.
5: Подзаголовок раздела «Быстрый старт».
6: Шаг 1 — установка зависимости express через npm.
7: Шаг 2 — запуск сервера командой node server/server.js (порт 3000 по умолчанию).
8: Шаг 3 — открыть приложение в браузере по localhost:3000.
9: Пустая строка-разделитель.
10: Подзаголовок «Потоки данных».
11: Пулевой пункт: сервер читает структуру формы из server/schema.json.
12: Пулевой пункт: отправленные данные пишутся в server/data/readings.json с меткой времени и логином.
13: Пулевой пункт: история по /api/records отдаёт только записи пользователя из заголовка x-username.
14: Пустая строка-разделитель.
15: Подзаголовок «Кастомизация».
16: Пулевой пункт: изменить схему можно правкой server/schema.json (string/number, вложенные resources).
17: Пулевой пункт: стили и верстка находятся в public/style.css и public/index.html.

# package.json
1: Открывающая скобка объекта package.json.
2: Начало блока зависимостей.
3: Запись зависимости express с версией ^5.2.1 для работы сервера.
4: Закрывающая скобка блока dependencies.
5: Закрывающая скобка JSON-файла.

# public/index.html
1: DOCTYPE объявляет HTML5 документ.
2: Открытие html с указанием языка ru.
3: Открытие head.
4: Метатег с кодировкой UTF-8.
5: Метатег viewport для адаптивности.
6: Тег title задаёт заголовок вкладки «Сбор показаний».
7: Предварительное соединение с доменом Google Fonts для оптимизации.
8: Предварительное соединение с gstatic для загрузки шрифтов.
9: Подключение шрифта Manrope с нужными толщинами.
10: Подключение основного файла стилей style.css.
11: Закрытие head.
12: Открытие body.
13: Корневой контейнер страницы с классом page.
14: Блок hero для шапки.
15: Внутренний div для содержания шапки.
16: Маленький заголовок-лейбл «Система сбора данных».
17: Закрытие внутреннего div.
18: Закрытие шапки hero.
19: Пустая строка для читаемости.
20: Открытие основного контента main с сеткой layout.
21: Секция панели авторизации с id auth-panel.
22: Заголовок панели авторизации.
23: Внутренний контейнер для текста.
24: Лейбл-надпись «Авторизация».
25: Заголовок h2 «Введите свой логин».
26: Закрытие внутреннего контейнера.
27: Закрытие panel-header.
28: Группа поля для ввода логина/квартиры.
29: Подпись к инпуту «Квартира или логин».
30: Поле ввода текста с placeholder и автокомплитом username.
31: Закрытие группы поля.
32: Кнопка primary для перехода к форме.
33: Закрытие секции авторизации.
34: Пустая строка.
35: Секция панели приложения (изначально скрыта классом hidden) с id app-panel.
36: Заголовок панели приложения.
37: Внутренний контейнер для текста.
38: Лейбл пользователя, который будет заполнен после входа.
39: Заголовок h2 «Форма по загруженной схеме».
40: Закрытие внутреннего контейнера.
41: Контейнер actions с кнопками управления.
42: Кнопка ghost «Вернуться» для выхода к авторизации.
43: Кнопка ghost «Обновить схему» для перезагрузки JSON-схемы.
44: Кнопка ghost «История» для загрузки прошлых показаний.
45: Закрытие контейнера actions.
46: Закрытие panel-header.
47: Пустая строка.
48: Форма, куда динамически добавляются поля по схеме.
49: Контейнер кнопок действий формы.
50: Кнопка primary «Сохранить показания» (type button).
51: Кнопка ghost «Очистить» (type button) для сброса полей.
52: Закрытие контейнера кнопок.
53: Пустая строка.
54: Контейнер истории отправок, скрыт по умолчанию.
55: Закрытие секции app-panel.
56: Закрытие main.
57: Закрытие page.
58: Подключение скрипта script.js.
59: Закрытие body.
60: Закрытие html.

# public/script.js
1: Объект state хранит текущего пользователя и загруженную схему.
2: Инициализация state.user значением null.
3: Инициализация state.schema значением null.
4: Закрывающая скобка объекта state.
5: Пустая строка.
6: Объект ui собирает ссылки на элементы интерфейса.
7: authPanel — ссылка на секцию авторизации.
8: appPanel — ссылка на секцию приложения.
9: usernameInput — поле ввода логина/квартиры.
10: userLabel — подпись с текущим пользователем.
11: form — контейнер динамической формы.
12: history — контейнер блока истории.
13: loginBtn — кнопка входа.
14: reloadBtn — кнопка обновления схемы.
15: historyBtn — кнопка загрузки истории.
16: backBtn — кнопка «Вернуться» к авторизации.
17: submitBtn — кнопка отправки формы.
18: resetBtn — кнопка очистки формы.
19: Закрывающая скобка объекта ui.
20: Пустая строка.
21: Навешивание обработчика клика на кнопку входа (handleLogin).
22: Обработчик клика на кнопку обновления схемы (loadSchemaAndRender).
23: Обработчик клика на кнопку истории (fetchHistory).
24: Обработчик клика на отправку формы (handleSubmit).
25: Обработчик клика на очистку формы: сброс полей, затем возврат значения квартиры, если пользователь задан.
26: Обработчик клика на кнопку «Вернуться» (handleBack).
27: Пустая строка.
28: Функция handleBack сбрасывает состояние и возвращает в экран авторизации.
29: Обнуляет state.user.
30: Очищает текст подписи пользователя.
31: Очищает HTML формы.
32: Скрывает блок истории.
33: Очищает содержимое блока истории.
34: Прячет панель приложения.
35: Показывает панель авторизации.
36: Ставит фокус в поле логина.
37: Закрытие функции handleBack.
38: Пустая строка.
39: handleLogin — обработка входа.
40: Берёт trimmed значение логина из поля.
41: Если логин пуст — предупреждает и выходит.
42: Сохраняет логин в state.user.
43: Обновляет подпись «Вы вошли как …».
44: Прячет блок авторизации.
45: Показывает панель приложения.
46: Загружает схему и рендерит форму.
47: Закрытие функции handleLogin.
48: Пустая строка.
49: loadSchemaAndRender — загрузка схемы и построение формы.
50: Пытается получить /api/schema.
51: Проверяет успешность ответа.
52: Парсит JSON схемы и сохраняет в state.schema.
53: Строит форму по схеме.
54: При ошибке показывает alert с текстом.
55: Закрытие функции.
56: Пустая строка.
57: renderForm — перерисовка формы.
58: Очищает контейнер формы.
59: Если схемы нет — выходит.
60: Добавляет DOM-дерево, построенное из схемы.
61: Ищет поле «квартира» в форме.
62: Если оно есть и пользователь задан — проставляет значение логина и делает поле только для чтения.
63: Закрытие функции.
64: Пустая строка.
65: buildNode — рекурсивно строит DOM по узлу схемы и пути.
66: Создаёт fieldset для группы.
67: Если у узла есть name — добавляет legend с этим текстом.
68: Перебирает ключи узла.
69: Пропускает ключ name, поскольку это заголовок блока.
70: value получает значение свойства.
71: Если ключ resources и это массив — для каждого ресурса строит вложенный блок с расширенным путём и добавляет в fieldset, затем переходит к следующему свойству.
72: Если значение — строковый тип string/number — создаёт строку формы.
73: Создаёт div.form-row.
74: Создаёт label с подписью «ключ:».
75: Создаёт input с типом number или text в зависимости от схемы.
76: Присваивает name равным ключу.
77: Сохраняет путь к этому полю в data-path через разделитель |.
78: Сохраняет тип поля в data-type.
79: Добавляет label и input в строку, а строку в текущий fieldset.
80: Продолжает обход до завершения и возвращает созданный fieldset.
81: Пустая строка.
82: assignByPath — раскладывает введённые значения в объект по пути.
83: Делит путь по «|» в массив частей.
84: current указывает на текущий объект внутри payload.
85: Проходит по частям пути циклом.
86: Вычисляет, последняя ли часть.
87: Если часть — resources, берёт следующий элемент как индекс, инициализирует массив и объект ресурса при необходимости, смещает указатель current в ресурс и пропускает индекс.
88: Если это последняя часть — приводит значение (для number в число или null при пустой строке) и записывает в текущий объект.
89: Иначе — создаёт вложенный объект при отсутствии и опускается внутрь.
90: Закрывает функцию.
91: Пустая строка.
92: handleSubmit — обработчик отправки формы.
93: Если пользователь не авторизован — предупреждение и выход.
94: Собирает все инпуты с data-path.
95: Готовит пустой объект payload.
96: Для каждого инпута размещает значение в payload через assignByPath.
97: Пытается отправить POST на /api/records с заголовком x-username и JSON-телом.
98: Получает JSON-ответ сервера.
99: При неуспехе выбрасывает ошибку с сообщением.
100: Показывает alert об успехе.
101: Сбрасывает форму.
102: Возвращает значение квартиры в поле после сброса.
103: Загружает историю, чтобы показать свежую запись.
104: При ошибках показывает alert.
105: Закрытие функции.
106: Пустая строка.
107: fetchHistory — загрузка истории пользователя.
108: Если нет пользователя — выход.
109: Делает GET /api/records с заголовком x-username.
110: Проверяет успех ответа.
111: Парсит JSON с записями.
112: Рендерит историю на страницу.
113: Показывает блок истории.
114: При ошибке показывает alert.
115: Закрытие функции.
116: Пустая строка.
117: renderHistory — выводит записи.
118: Очищает контейнер истории.
119: Если записей нет — пишет подсказку «Записей пока нет.» и выходит.
120: Берёт копию списка в обратном порядке (последние сверху) и для каждой записи строит карточку.
121: Создаёт div.history-card.
122: Создаёт header карточки.
123: Заголовок strong: имя записи (или «Отправка»).
124: Элемент даты с классом date.
125: Дата берётся из meta.capturedAt и форматируется локально; иначе «Без времени».
126: Добавляет заголовок и дату в header.
127: pre с JSON записи для просмотра полей.
128: Добавляет header и pre в карточку.
129: Добавляет карточку в контейнер истории.
130: Закрытие функции и файла.

# public/style.css
1: Определение CSS-переменных: фоны, акценты, текст, радиус, тени, шрифт.
2: Цвет фона страницы.
3: Цвет панелей.
4: Основной акцентный цвет.
5: Цвет акцента при наведении.
6: Основной цвет текста.
7: Приглушённый цвет текста.
8: Цвет рамок.
9: Цвет фона инпутов.
10: Радиус скругления элементов.
11: Значение теней.
12: Шрифтовой стек.
13: Закрытие :root.
14: Пустая строка.
15: Универсальный box-sizing для всех элементов.
16: Пустая строка.
17: Сброс отступов body, минимальная высота, шрифт, фон, цвет текста, межстрочный интервал.
18: Пустая строка.
19: Контейнер page с максимальной шириной, автоцентрированием и внутренними отступами.
20: Пустая строка.
21: Секция hero центрирует текст и задаёт отступ снизу.
22: Настройки заголовка hero h1: размер, вес, отступы, кернинг, цвет.
23: Пустая строка.
24: Стиль eyebrow: капс, размер, вес, интервал, акцентный цвет, отступ.
25: lede — увеличенный спокойный текст, ограничение ширины, автоцентрирование.
26: Пустая строка.
27: layout — колонка с отступом между секциями.
28: Пустая строка.
29: panel — белая карточка с радиусом, паддингом, тенью и рамкой.
30: Пустая строка.
31: panel-header — флекс между заголовком и действиями, перенос, зазоры.
32: Заголовок h2 в панели: нулевые отступы, размер, вес, цвет.
33: Пустая строка.
34: field-group — колонка для метки и поля с зазором и нижним отступом.
35: Метка поля: размер, вес, цвет.
36: Общие стили для input text/number: ширина 100%, паддинги, радиус, рамка, фон, шрифт, плавные переходы.
37: Стили фокуса: убирает outline, меняет цвет рамки и добавляет светлое свечение.
38: Пустая строка.
39: hint — мелкий приглушённый текст с отступом сверху.
40: Пустая строка.
41: actions — флекс с зазором, переносом.
42: Пустая строка.
43: Общие стили кнопок: флекс центр, паддинги, радиус, жирность, курсор, переход, без рамки.
44: primary — синяя кнопка с белым текстом.
45: hover primary — темнее и лёгкий подъём.
46: ghost — прозрачная кнопка с серым текстом и рамкой.
47: hover ghost — темнее текст, подсветка рамкой и светлый фон.
48: Пустая строка.
49: fieldset — рамка, скругление, паддинг, нижний отступ, слегка серый фон для вложенных групп.
50: legend — жирный тёмный текст, отступы, размер 1.1rem.
51: form-row — грид из двух колонок 1:2 с зазором и выравниванием, нижний отступ.
52: У последней строки нет нижнего отступа.
53: label в строке — полужирный, приглушённый, выравнивание по правому краю.
54: form-actions — верхний отступ и разделительная линия, флекс-кнопки с зазором.
55: Пустая строка.
56: history — столбец карточек с отступами.
57: history-card — белая карточка с рамкой, радиусом, паддингом и плавным hover.
58: hover history-card подсвечивает рамку акцентом.
59: header карточки — флекс между заголовком и датой, нижний отступ и разделительная линия.
60: strong в header — тёмный текст.
61: date — мелкий приглушённый текст на светлом фоне с паддингом и радиусом.
62: pre — моноширинный вывод JSON, приглушённый фон, паддинг и радиус.
63: hidden — скрывает элемент через display: none !important.
64: Пустая строка.
65: Медиа-запрос до 640px: строки формы становятся одноколоночными, правое выравнивание меток отменяется, уменьшаются паддинги панели, заголовок панели в столбец, кнопки в actions растягиваются.

# server/server.js
1: Импортирует express для веб-сервера.
2: Импортирует path для работы с путями.
3: Импортирует fs для констант и совместимости.
4: Импортирует промис-версии операций чтения/записи/каталога/доступа.
5: Пустая строка.
6: Создаёт приложение Express.
7: Определяет порт из окружения или 3000.
8: Пустая строка.
9: Вычисляет корень проекта (папка выше server).
10: Путь к статическим файлам public.
11: Путь к каталогу данных server/data.
12: Путь к файлу «БД» readings.json.
13: Путь к файлу схемы schema.json.
14: Пустая строка.
15: Включает парсинг JSON тела запросов.
16: Раздаёт статические файлы из public.
17: Пустая строка.
18: ensureStorage — гарантирует наличие каталога и файла базы.
19: Создаёт каталог data рекурсивно.
20: Пытается проверить существование DB_FILE.
21: Если файла нет — создаёт его с пустым массивом JSON.
22: Закрытие функции.
23: Пустая строка.
24: readJson — читает JSON-файл, при ошибке возвращает fallback или кидает ошибку.
25: Пустая строка.
26: writeJson — сериализует объект в JSON с форматированием и пишет в файл.
27: Пустая строка.
28: respondError — отправляет ответ с кодом и сообщением об ошибке в JSON.
29: Пустая строка.
30: GET /api/schema — отдаёт содержимое файла схемы.
31: Пытается прочитать schema.json и вернуть его как JSON.
32: При ошибке отвечает 500 и сообщением о проблеме чтения схемы.
33: Пустая строка.
34: POST /api/records — сохраняет новую запись пользователя.
35: Читает логин из заголовка x-username, обрезает пробелы.
36: Если логин не передан — 400 с ошибкой.
37: Копирует тело запроса в payload.
38: Принудительно записывает поле «квартира» значением логина.
39: Добавляет meta с временем создания и пользователем.
40: Пытается прочитать массив записей из базы (или пустой массив), пушит новую запись, сохраняет файл и отвечает успехом.
41: При ошибке — 500 и сообщение о невозможности сохранить.
42: Пустая строка.
43: GET /api/records — отдаёт записи только для текущего пользователя.
44: Читает логин из заголовка; если его нет — возвращает пустой массив.
45: Пытается прочитать базу, фильтрует записи по полю «квартира», возвращает результат.
46: При ошибке — 500 и сообщение о невозможности прочитать базу.
47: Пустая строка.
48: ensureStorage запускается, затем сервер слушает порт и логирует URL; при ошибке старта выводит ошибку в консоль.

# server/schema.json
1: Открытие объекта схемы.
2: Заголовок верхнего блока формы «Показания счетчиков».
3: Поле «квартира» с типом string.
4: Массив resources для вложенных ресурсов.
5: Первый ресурс — объект с name «Вода» и числовым полем «показания счетчика».
6: Второй ресурс — «Электричество» с двумя числовыми полями тарифов.
7: Третий ресурс — «Газ» с числовым полем «показания счетчика».
8: Закрывающие скобки массива и объекта.

